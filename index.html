<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Amine Smart Parrot AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #00fff2; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #canvas-container { width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; z-index: 1; }
        #ui-layer { position: relative; z-index: 2; pointer-events: none; width: 100%; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding-bottom: 40px; }
        .controls { pointer-events: auto; background: rgba(0, 0, 0, 0.6); padding: 25px; border-radius: 30px; border: 2px solid #ffcc00; backdrop-filter: blur(15px); text-align: center; box-shadow: 0 0 30px rgba(255, 204, 0, 0.3); }
        button { background: #ffcc00; color: #000; border: none; padding: 15px 35px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 18px; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        button:hover { transform: scale(1.1); background: #fff; }
        #status-text { margin-bottom: 15px; font-size: 16px; font-weight: bold; color: #ffcc00; letter-spacing: 2px; }
        .speaking { animation: shake 0.5s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 20% { transform: translate(-1px, -2px) rotate(-1deg); } 40% { transform: translate(-3px, 0px) rotate(1deg); } 100% { transform: translate(1px, 1px) rotate(0deg); } }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="ui-layer">
        <div class="controls">
            <div id="status-text">ðŸ¦œ PARROT AI ONLINE</div>
            <button id="start-btn">ðŸ¦œ Ø§Ø¶ØºØ· Ù„ØªØ­Ø¯Ø« Ø§Ù„Ø¨Ø¨ØºØ§Ø¡</button>
            <div id="transcript" style="margin-top: 15px; font-size: 14px; color: #fff; opacity: 0.8;"></div>
        </div>
    </div>

    <script>
        // --- 3D SPACE & PARROT ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Space Stars
        const starsGeo = new THREE.BufferGeometry();
        const starsCount = 2000;
        const starPos = new Float32Array(starsCount * 3);
        for(let i=0; i<starsCount * 3; i++) { starPos[i] = (Math.random() - 0.5) * 20; }
        starsGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const stars = new THREE.Points(starsGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.02}));
        scene.add(stars);

        // Stylized Parrot Group
        const parrot = new THREE.Group();
        
        // Body (Simplified with Cylinder since CapsuleGeometry is newer)
        const bodyGeo = new THREE.CylinderGeometry(0.4, 0.4, 1.2, 16);
        const body = new THREE.Mesh(bodyGeo, new THREE.MeshPhongMaterial({color: 0xff0000}));
        parrot.add(body);

        // Head (Red)
        const head = new THREE.Mesh(new THREE.SphereGeometry(0.4, 16, 16), new THREE.MeshPhongMaterial({color: 0xff0000}));
        head.position.y = 0.8;
        parrot.add(head);

        // Beak (Yellow)
        const beak = new THREE.Mesh(new THREE.ConeGeometry(0.15, 0.4, 16), new THREE.MeshPhongMaterial({color: 0xffcc00}));
        beak.rotation.x = Math.PI / 2;
        beak.position.set(0, 0.8, 0.4);
        parrot.add(beak);

        // Wings (Blue)
        const wingL = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.8, 0.4), new THREE.MeshPhongMaterial({color: 0x0000ff}));
        wingL.position.set(-0.5, 0.2, 0);
        const wingR = wingL.clone();
        wingR.position.x = 0.5;
        parrot.add(wingL, wingR);

        // Speech Waves (Rings)
        const rings = [];
        for(let i=0; i<3; i++) {
            const ring = new THREE.Mesh(
                new THREE.TorusGeometry(1 + i*0.3, 0.02, 16, 100),
                new THREE.MeshBasicMaterial({color: 0x00fff2, transparent: true, opacity: 0.5})
            );
            ring.rotation.x = Math.PI / 2;
            scene.add(ring);
            rings.push(ring);
        }

        scene.add(parrot);
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 5, 5);
        scene.add(light, new THREE.AmbientLight(0x404040));
        camera.position.set(0, 0, 4);

        function animate() {
            requestAnimationFrame(animate);
            parrot.rotation.y += 0.01;
            parrot.position.y = Math.sin(Date.now() * 0.002) * 0.2; // Float effect
            stars.rotation.y += 0.0005;
            
            // Pulse rings
            rings.forEach((r, i) => {
                r.scale.setScalar(1 + Math.sin(Date.now() * 0.005 + i) * 0.1);
                r.material.opacity = 0.5 + Math.sin(Date.now() * 0.005 + i) * 0.2;
            });
            
            renderer.render(scene, camera);
        }
        animate();

        // --- BRAIN CONNECTION ---
        const startBtn = document.getElementById('start-btn');
        const statusText = document.getElementById('status-text');
        const transcriptDiv = document.getElementById('transcript');
        const GATEWAY_URL = "ws://34.31.199.7:18789/ws"; // Your IP

        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new Speech();
        recognition.lang = 'ar-SA';

        recognition.onstart = () => { startBtn.innerText = "ðŸ¦œ Ø§Ù„Ø¨Ø¨ØºØ§Ø¡ ÙŠÙ†ØµØª..."; startBtn.style.background = "#fff"; };
        recognition.onresult = (e) => {
            const text = e.results[0][0].transcript;
            transcriptDiv.innerText = "Ø£Ù†Øª: " + text;
            sendToBrain(text);
        };
        recognition.onend = () => { startBtn.innerText = "ðŸ¦œ Ø§Ø¶ØºØ· Ù„ØªØ­Ø¯Ø« Ø§Ù„Ø¨Ø¨ØºØ§Ø¡"; startBtn.style.background = "#ffcc00"; };

        function sendToBrain(msg) {
            const ws = new WebSocket(GATEWAY_URL);
            ws.onopen = () => {
                ws.send(JSON.stringify({type:"auth", token:"f1dbc616b475a94e309fcb944a14509a21983c793e290426"}));
                ws.send(JSON.stringify({type:"user_message", text: msg}));
            };
            ws.onmessage = (ev) => {
                const d = JSON.parse(ev.data);
                if(d.type === "agent_response") parrotSpeak(d.text);
            };
        }

        function parrotSpeak(text) {
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'ar-SA';
            u.pitch = 1.5; // High pitch like a parrot!
            u.onstart = () => { parrot.scale.setScalar(1.2); statusText.innerText = "ðŸ¦œ Ø§Ù„Ø¨Ø¨ØºØ§Ø¡ ÙŠØªØ­Ø¯Ø«..."; };
            u.onend = () => { parrot.scale.setScalar(1); statusText.innerText = "ðŸ¦œ PARROT AI ONLINE"; };
            window.speechSynthesis.speak(u);
        }

        startBtn.onclick = () => recognition.start();
    </script>
</body>
</html>